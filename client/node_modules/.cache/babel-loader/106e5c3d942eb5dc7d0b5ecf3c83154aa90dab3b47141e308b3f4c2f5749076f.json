{"ast":null,"code":"import React,{useEffect,useState}from'react';import Cookies from'js-cookie';import{Link}from'react-router-dom';import Header from'../Header/Header';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProductList=()=>{const[products,setProducts]=useState([]);const userId=Cookies.get('userId');const apiURL=process.env.REACT_APP_API_URL||'http://localhost:5000';useEffect(()=>{const fetchProducts=async()=>{try{const token=Cookies.get('authToken');if(!token){console.error('No auth token found!');return;}const response=await fetch(\"\".concat(apiURL,\"/api/products\"),{headers:{Authorization:\"Bearer \".concat(token)},credentials:'include'});if(!response.ok){throw new Error('Failed to fetch products');}const data=await response.json();setProducts(data);}catch(error){console.error('Request failed with status code 403',error);}};fetchProducts();},[apiURL]);// Include apiURL in the dependency array\nconst handleAddToCart=async productId=>{try{const token=Cookies.get('authToken');if(!token){console.error('No auth token found!');return;}const response=await fetch(\"\".concat(apiURL,\"/api/cart\"),{method:'POST',headers:{Authorization:\"Bearer \".concat(token),'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({user_id:userId,product_id:productId,quantity:1})});if(response.ok){alert('Product added to cart!');}else{const errorData=await response.json();console.error('Failed to add product to cart:',errorData.message);alert('Failed to add product to cart.');}}catch(error){console.error('Error adding product to cart:',error);alert('Failed to add product to cart.');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"routes-bg\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"products-bg\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Products\"}),/*#__PURE__*/_jsx(\"ul\",{children:products.map(product=>/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsxs(Link,{to:\"/products/\".concat(product.id),className:\"product-link\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"stock-name\",children:product.name}),\" \",/*#__PURE__*/_jsx(\"p\",{children:\"Know more about the stock...\"}),\" \",/*#__PURE__*/_jsxs(\"p\",{children:[\"Rs.\",product.price]}),\" \",/*#__PURE__*/_jsxs(\"p\",{children:[\" Stocks \",product.stock]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"add-cart-btn\",onClick:()=>handleAddToCart(product.id),children:\"Add to Cart\"})]},product.id))})]})]});};export default ProductList;","map":{"version":3,"names":["React","useEffect","useState","Cookies","Link","Header","jsx","_jsx","jsxs","_jsxs","ProductList","products","setProducts","userId","get","apiURL","process","env","REACT_APP_API_URL","fetchProducts","token","console","error","response","fetch","concat","headers","Authorization","credentials","ok","Error","data","json","handleAddToCart","productId","method","body","JSON","stringify","user_id","product_id","quantity","alert","errorData","message","className","children","map","product","to","id","name","price","stock","onClick"],"sources":["D:/Claw Enterprises/client/src/components/Products/ProductList.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport Cookies from 'js-cookie';\r\nimport { Link } from 'react-router-dom';\r\nimport Header from '../Header/Header';\r\n\r\nconst ProductList = () => {\r\n  const [products, setProducts] = useState([]);\r\n  const userId = Cookies.get('userId');\r\n  const apiURL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\r\n\r\n  useEffect(() => {\r\n    const fetchProducts = async () => {\r\n      try {\r\n        const token = Cookies.get('authToken');\r\n\r\n        if (!token) {\r\n          console.error('No auth token found!');\r\n          return;\r\n        }\r\n\r\n        const response = await fetch(`${apiURL}/api/products`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n          credentials: 'include',\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error('Failed to fetch products');\r\n        }\r\n\r\n        const data = await response.json();\r\n        setProducts(data);\r\n      } catch (error) {\r\n        console.error('Request failed with status code 403', error);\r\n      }\r\n    };\r\n\r\n    fetchProducts();\r\n  }, [apiURL]); // Include apiURL in the dependency array\r\n\r\n  const handleAddToCart = async (productId) => {\r\n    try {\r\n      const token = Cookies.get('authToken');\r\n\r\n      if (!token) {\r\n        console.error('No auth token found!');\r\n        return;\r\n      }\r\n\r\n      const response = await fetch(`${apiURL}/api/cart`, {\r\n        method: 'POST',\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          user_id: userId,\r\n          product_id: productId,\r\n          quantity: 1,\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        alert('Product added to cart!');\r\n      } else {\r\n        const errorData = await response.json();\r\n        console.error('Failed to add product to cart:', errorData.message);\r\n        alert('Failed to add product to cart.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error adding product to cart:', error);\r\n      alert('Failed to add product to cart.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"routes-bg\">\r\n      <Header />\r\n      <div className=\"products-bg\">\r\n        <h1>Products</h1>\r\n        <ul>\r\n          {products.map((product) => (\r\n            <li key={product.id}>\r\n              <Link to={`/products/${product.id}`} className='product-link'>\r\n                <p className='stock-name'>{product.name}</p> <p>Know more about the stock...</p> <p>Rs.{product.price}</p> <p> Stocks {product.stock}</p>\r\n              </Link>\r\n              <button className='add-cart-btn' onClick={() => handleAddToCart(product.id)}>Add to Cart</button>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProductList;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,MAAO,CAAAC,OAAO,KAAM,WAAW,CAC/B,OAASC,IAAI,KAAQ,kBAAkB,CACvC,MAAO,CAAAC,MAAM,KAAM,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEtC,KAAM,CAAAC,WAAW,CAAGA,CAAA,GAAM,CACxB,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGV,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAAW,MAAM,CAAGV,OAAO,CAACW,GAAG,CAAC,QAAQ,CAAC,CACpC,KAAM,CAAAC,MAAM,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,CAEvEjB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAkB,aAAa,CAAG,KAAAA,CAAA,GAAY,CAChC,GAAI,CACF,KAAM,CAAAC,KAAK,CAAGjB,OAAO,CAACW,GAAG,CAAC,WAAW,CAAC,CAEtC,GAAI,CAACM,KAAK,CAAE,CACVC,OAAO,CAACC,KAAK,CAAC,sBAAsB,CAAC,CACrC,OACF,CAEA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIV,MAAM,kBAAiB,CACrDW,OAAO,CAAE,CAAEC,aAAa,WAAAF,MAAA,CAAYL,KAAK,CAAG,CAAC,CAC7CQ,WAAW,CAAE,SACf,CAAC,CAAC,CAEF,GAAI,CAACL,QAAQ,CAACM,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAC,KAAK,CAAC,0BAA0B,CAAC,CAC7C,CAEA,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAR,QAAQ,CAACS,IAAI,CAAC,CAAC,CAClCpB,WAAW,CAACmB,IAAI,CAAC,CACnB,CAAE,MAAOT,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CAAC,qCAAqC,CAAEA,KAAK,CAAC,CAC7D,CACF,CAAC,CAEDH,aAAa,CAAC,CAAC,CACjB,CAAC,CAAE,CAACJ,MAAM,CAAC,CAAC,CAAE;AAEd,KAAM,CAAAkB,eAAe,CAAG,KAAO,CAAAC,SAAS,EAAK,CAC3C,GAAI,CACF,KAAM,CAAAd,KAAK,CAAGjB,OAAO,CAACW,GAAG,CAAC,WAAW,CAAC,CAEtC,GAAI,CAACM,KAAK,CAAE,CACVC,OAAO,CAACC,KAAK,CAAC,sBAAsB,CAAC,CACrC,OACF,CAEA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,IAAAC,MAAA,CAAIV,MAAM,cAAa,CACjDoB,MAAM,CAAE,MAAM,CACdT,OAAO,CAAE,CACPC,aAAa,WAAAF,MAAA,CAAYL,KAAK,CAAE,CAChC,cAAc,CAAE,kBAClB,CAAC,CACDQ,WAAW,CAAE,SAAS,CACtBQ,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,OAAO,CAAE1B,MAAM,CACf2B,UAAU,CAAEN,SAAS,CACrBO,QAAQ,CAAE,CACZ,CAAC,CACH,CAAC,CAAC,CAEF,GAAIlB,QAAQ,CAACM,EAAE,CAAE,CACfa,KAAK,CAAC,wBAAwB,CAAC,CACjC,CAAC,IAAM,CACL,KAAM,CAAAC,SAAS,CAAG,KAAM,CAAApB,QAAQ,CAACS,IAAI,CAAC,CAAC,CACvCX,OAAO,CAACC,KAAK,CAAC,gCAAgC,CAAEqB,SAAS,CAACC,OAAO,CAAC,CAClEF,KAAK,CAAC,gCAAgC,CAAC,CACzC,CACF,CAAE,MAAOpB,KAAK,CAAE,CACdD,OAAO,CAACC,KAAK,CAAC,+BAA+B,CAAEA,KAAK,CAAC,CACrDoB,KAAK,CAAC,gCAAgC,CAAC,CACzC,CACF,CAAC,CAED,mBACEjC,KAAA,QAAKoC,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxBvC,IAAA,CAACF,MAAM,GAAE,CAAC,cACVI,KAAA,QAAKoC,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1BvC,IAAA,OAAAuC,QAAA,CAAI,UAAQ,CAAI,CAAC,cACjBvC,IAAA,OAAAuC,QAAA,CACGnC,QAAQ,CAACoC,GAAG,CAAEC,OAAO,eACpBvC,KAAA,OAAAqC,QAAA,eACErC,KAAA,CAACL,IAAI,EAAC6C,EAAE,cAAAxB,MAAA,CAAeuB,OAAO,CAACE,EAAE,CAAG,CAACL,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3DvC,IAAA,MAAGsC,SAAS,CAAC,YAAY,CAAAC,QAAA,CAAEE,OAAO,CAACG,IAAI,CAAI,CAAC,IAAC,cAAA5C,IAAA,MAAAuC,QAAA,CAAG,8BAA4B,CAAG,CAAC,IAAC,cAAArC,KAAA,MAAAqC,QAAA,EAAG,KAAG,CAACE,OAAO,CAACI,KAAK,EAAI,CAAC,IAAC,cAAA3C,KAAA,MAAAqC,QAAA,EAAG,UAAQ,CAACE,OAAO,CAACK,KAAK,EAAI,CAAC,EACrI,CAAC,cACP9C,IAAA,WAAQsC,SAAS,CAAC,cAAc,CAACS,OAAO,CAAEA,CAAA,GAAMrB,eAAe,CAACe,OAAO,CAACE,EAAE,CAAE,CAAAJ,QAAA,CAAC,aAAW,CAAQ,CAAC,GAJ1FE,OAAO,CAACE,EAKb,CACL,CAAC,CACA,CAAC,EACF,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAxC,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}